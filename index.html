<!doctype html>
<html lang="az">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Günlük Hesablama — Gülşad, Aidə, Arzu</title>
  <style>
    :root{--bg:#0f1724;--card:#111827;--accent:#06b6d4;--muted:#94a3b8;--glass: rgba(255,255,255,0.03)}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;color:#e6eef6;background:linear-gradient(180deg,#071028 0%, #081226 60%);}
    .app{max-width:1000px;margin:28px auto;padding:22px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    h1{font-size:20px;margin:0;color:#fff}
    p.lead{margin:0;color:var(--muted);font-size:13px}

    /* layout */
    .grid{display:grid;grid-template-columns:1fr 360px;gap:18px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:14px;padding:16px;box-shadow:0 6px 18px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03)}

    /* form */
    .people{display:flex;gap:10px;flex-direction:column}
    .row{display:flex;gap:10px;align-items:center}
    label{font-size:13px;color:var(--muted);min-width:80px}
    input[type="number"], textarea{flex:1;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:var(--glass);color:#fff;outline:none}
    input[type="number"]::-webkit-inner-spin-button{opacity:0.6}
    .name{min-width:120px;font-weight:600}

    .totals{display:flex;align-items:center;justify-content:space-between;margin-top:16px;padding:12px;border-radius:10px;background:linear-gradient(90deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03)}
    .total-label{font-size:13px;color:var(--muted)}
    .total-value{font-size:20px;font-weight:700;color:var(--accent)}

    .actions{display:flex;gap:8px;margin-top:12px}
    button{cursor:pointer;padding:10px 12px;border-radius:10px;border: none;background:linear-gradient(180deg,#0ea5a8,#0891b2);color:#022; font-weight:700}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.05);color:var(--muted);font-weight:600}
    button.danger{background:linear-gradient(180deg,#fb7185,#f43f5e);color:#fff}

    /* records */
    .records-list{max-height:540px;overflow:auto;padding-right:6px}
    .record{display:flex;align-items:center;justify-content:space-between;padding:10px;border-radius:10px;margin-bottom:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));border:1px solid rgba(255,255,255,0.02);transition:transform .22s ease, box-shadow .22s}
    .record:hover{transform:translateY(-4px);box-shadow:0 8px 24px rgba(2,6,23,0.6)}
    .rec-left{display:flex;gap:10px;align-items:center}
    .badge{font-size:12px;padding:6px 8px;border-radius:8px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.02);color:var(--muted)}
    .rec-meta{font-size:13px;color:var(--muted)}
    .rec-amount{font-weight:700}
    .rec-actions{display:flex;gap:8px}
    .icon-btn{padding:6px 8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:var(--muted);cursor:pointer}

    /* empty */
    .empty{padding:36px;text-align:center;color:var(--muted)}

    /* small screens */
    @media(max-width:920px){.grid{grid-template-columns:1fr;}.app{padding:12px}}

    /* subtle animations */
    .pulse{animation:pulse 2s infinite}
    @keyframes pulse{0%{box-shadow:0 0 0 0 rgba(6,182,212,0.14)}70%{box-shadow:0 0 0 14px rgba(6,182,212,0)}100%{box-shadow:0 0 0 0 rgba(6,182,212,0)}}

    /* form focus */
    input:focus, textarea:focus{border-color:rgba(6,182,212,0.9);box-shadow:0 6px 20px rgba(6,182,212,0.06)}

    /* nice scrollbar */
    .records-list::-webkit-scrollbar{width:8px}
    .records-list::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.03);border-radius:10px}

  </style>
</head>
<body>
  <div class="app">
    <header>
      <div>
        <h1>Günlük Hesablama</h1>
        <p class="lead">Gülşad, Aidə, Arzu üçün kart məbləğlərini daxil edin — cəmi avtomatik hesablanır. Qeydlər gündəlik saxlanır, düzəliş və silmək mümkündür.</p>
      </div>
      <div style="text-align:right;color:var(--muted);font-size:13px">
        <div id="todayDisplay">Tarix: --</div>
        <div id="clock" style="font-weight:600"></div>
      </div>
    </header>

    <main class="grid">
      <section class="card">
        <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:10px">
          <div>
            <strong style="font-size:15px">Yeni Qeyd</strong>
            <div style="font-size:13px;color:var(--muted)">Bu gün üçün məbləğləri daxil edin və "Saxla" düyməsinə basın.</div>
          </div>
          <div class="badge">Statik sayt — yerli yaddaş (browser)</div>
        </div>

        <form id="entryForm" style="margin-top:14px">
          <div class="people">
            <div class="row">
              <div class="name">Gülşad</div>
              <label for="gulshad">AZN</label>
              <input id="gulshad" type="number" step="0.01" min="0" placeholder="0.00" />
            </div>

            <div class="row">
              <div class="name">Aidə</div>
              <label for="aide">AZN</label>
              <input id="aide" type="number" step="0.01" min="0" placeholder="0.00" />
            </div>

            <div class="row">
              <div class="name">Arzu</div>
              <label for="arzu">AZN</label>
              <input id="arzu" type="number" step="0.01" min="0" placeholder="0.00" />
            </div>

            <div style="margin-top:8px">
              <label style="display:block;margin-bottom:6px;color:var(--muted)">Qeyd</label>
              <textarea id="note" rows="3" placeholder="Qısa qeyd..." style="resize:vertical"></textarea>
            </div>

            <div class="totals">
              <div>
                <div class="total-label">Cəm</div>
                <div class="total-value" id="totalValue">0.00 AZN</div>
              </div>
              <div style="text-align:right;color:var(--muted);font-size:13px">
                <div id="previewBreakdown">Gülşad 0.00 • Aidə 0.00 • Arzu 0.00</div>
                <div style="font-size:12px;margin-top:6px">Həmişə avtomatik olaraq yenilənir</div>
              </div>
            </div>

            <div class="actions">
              <button type="button" id="saveBtn">Saxla</button>
              <button type="button" class="ghost" id="clearBtn">Sıfırla Sahələr</button>
              <button type="button" class="ghost" id="newDayBtn">Yeni Günə Keç</button>
            </div>
          </div>
        </form>

      </section>

      <aside class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
          <div>
            <strong>Qeydlər (gündəlik arxiv)</strong>
            <div style="font-size:13px;color:var(--muted)">Tarix üzrə saxlanmış qeydləri redaktə və silə bilərsiniz.</div>
          </div>
          <div style="display:flex;gap:8px">
            <button class="ghost" id="exportBtn">Export JSON</button>
            <button class="ghost" id="importBtn">Import</button>
            <button class="danger" id="clearAllBtn">Hamısını Sil</button>
          </div>
        </div>

        <div class="records-list" id="recordsList">
          <div class="empty">Qeyd tapılmadı — ilk qeydi yaradın.</div>
        </div>

      </aside>
    </main>
  </div>

  <template id="recordTemplate">
    <div class="record" data-id="">
      <div class="rec-left">
        <div class="badge rec-date">01.01.1970</div>
        <div>
          <div class="rec-meta rec-note">Qeyd məzmunu...</div>
          <div class="rec-meta">Gülşad: <span class="rec-amount rec-gul">0.00</span> • Aidə: <span class="rec-amount rec-aid">0.00</span> • Arzu: <span class="rec-amount rec-arz">0.00</span></div>
        </div>
      </div>
      <div style="display:flex;align-items:center;gap:8px">
        <div style="text-align:right;margin-right:8px">
          <div style="font-size:12px;color:var(--muted)">Cəm</div>
          <div class="rec-total rec-amount">0.00</div>
        </div>
        <div class="rec-actions">
          <button class="icon-btn editBtn">Düzəliş</button>
          <button class="icon-btn delBtn">Sil</button>
        </div>
      </div>
    </div>
  </template>

  <script>
    // --- Utilities ---
    const LS_KEY = 'hesablama_records_v1';

    function formatMoney(n){
      const v = Number(n) || 0;
      // Use Azerbaijani locale if available, fallback to 2 decimals
      try{ return v.toLocaleString('az-AZ',{minimumFractionDigits:2,maximumFractionDigits:2}) + ' AZN'; }catch(e){ return v.toFixed(2) + ' AZN'; }
    }

    function nowDate(){
      const d = new Date();
      return d.toISOString().slice(0,10); // YYYY-MM-DD
    }

    function niceDateISO(iso){
      if(!iso) return '--';
      const [y,m,d] = iso.split('-');
      return d + '.' + m + '.' + y;
    }

    // --- State & storage ---
    function loadRecords(){
      const raw = localStorage.getItem(LS_KEY);
      try{ return raw ? JSON.parse(raw) : []; }catch(e){return []}
    }
    function saveRecords(list){
      localStorage.setItem(LS_KEY, JSON.stringify(list));
    }

    // --- DOM refs ---
    const gul = document.getElementById('gulshad');
    const aid = document.getElementById('aide');
    const arz = document.getElementById('arzu');
    const note = document.getElementById('note');
    const totalValue = document.getElementById('totalValue');
    const preview = document.getElementById('previewBreakdown');
    const recordsList = document.getElementById('recordsList');
    const todayDisplay = document.getElementById('todayDisplay');
    const clockEl = document.getElementById('clock');

    // form buttons
    const saveBtn = document.getElementById('saveBtn');
    const clearBtn = document.getElementById('clearBtn');
    const newDayBtn = document.getElementById('newDayBtn');
    const exportBtn = document.getElementById('exportBtn');
    const importBtn = document.getElementById('importBtn');
    const clearAllBtn = document.getElementById('clearAllBtn');

    // template
    const tpl = document.getElementById('recordTemplate');

    // current edit id
    let editingId = null;

    // --- Logic ---
    function computeTotal(){
      const g = parseFloat(gul.value) || 0;
      const a = parseFloat(aid.value) || 0;
      const r = parseFloat(arz.value) || 0;
      const s = g + a + r;
      totalValue.textContent = formatMoney(s);
      preview.textContent = `Gülşad ${formatMoney(g)} • Aidə ${formatMoney(a)} • Arzu ${formatMoney(r)}`;
      return {g,a,r,s};
    }

    function clearForm(){
      gul.value = ''; aid.value = ''; arz.value = ''; note.value = '';
      editingId = null;
      computeTotal();
      saveBtn.textContent = 'Saxla';
      saveBtn.style.background = '';
    }

    function renderRecords(){
      const list = loadRecords().sort((a,b)=> b.time - a.time);
      recordsList.innerHTML = '';
      if(!list.length){
        recordsList.innerHTML = '<div class="empty">Qeyd tapılmadı — ilk qeydi yaradın.</div>';
        return;
      }
      for(const r of list){
        const node = tpl.content.cloneNode(true);
        const root = node.querySelector('.record');
        root.dataset.id = r.id;
        node.querySelector('.rec-date').textContent = niceDateISO(r.date);
        node.querySelector('.rec-note').textContent = r.note || '—';
        node.querySelector('.rec-gul').textContent = formatMoney(r.gul);
        node.querySelector('.rec-aid').textContent = formatMoney(r.aid);
        node.querySelector('.rec-arz').textContent = formatMoney(r.arz);
        node.querySelector('.rec-total').textContent = formatMoney(r.total);

        node.querySelector('.editBtn').addEventListener('click',()=> startEdit(r.id));
        node.querySelector('.delBtn').addEventListener('click',()=> deleteRecord(r.id));

        recordsList.appendChild(node);
      }
    }

    function saveCurrent(){
      const list = loadRecords();
      const {g,a,r,s} = computeTotal();
      const rec = {
        id: editingId || 'id_' + Date.now(),
        date: nowDate(),
        time: Date.now(),
        gul: Number(g.toFixed(2)),
        aid: Number(a.toFixed(2)),
        arz: Number(r.toFixed(2)),
        total: Number(s.toFixed(2)),
        note: note.value || ''
      };

      if(editingId){
        const idx = list.findIndex(x=>x.id===editingId);
        if(idx>-1) list[idx] = rec;
      } else {
        list.push(rec);
      }
      saveRecords(list);
      renderRecords();
      clearForm();
      flashSaved();
    }

    function startEdit(id){
      const list = loadRecords();
      const r = list.find(x=>x.id===id);
      if(!r) return alert('Qeyd tapılmadı');
      editingId = id;
      gul.value = r.gul; aid.value = r.aid; arz.value = r.arz; note.value = r.note;
      computeTotal();
      saveBtn.textContent = 'Düzəlişi Saxla';
      saveBtn.style.background = 'linear-gradient(180deg,#f59e0b,#d97706)';
      window.scrollTo({top:0,behavior:'smooth'});
    }

    function deleteRecord(id){
      if(!confirm('Bu qeydi silmək istədiyinizə əminsiniz?')) return;
      const list = loadRecords().filter(x=>x.id!==id);
      saveRecords(list);
      renderRecords();
    }

    function clearAll(){
      if(!confirm('Bütün qeydləri silmək istədiyinizə əminsiniz? Bu əməliyyat geri alınmaz.')) return;
      localStorage.removeItem(LS_KEY);
      renderRecords();
    }

    // small visual feedback
    function flashSaved(){
      saveBtn.classList.add('pulse');
      setTimeout(()=>saveBtn.classList.remove('pulse'),1200);
    }

    // Export/Import
    exportBtn.addEventListener('click',()=>{
      const data = localStorage.getItem(LS_KEY) || '[]';
      const blob = new Blob([data],{type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'hesablama_records_' + nowDate() + '.json';
      document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    });

    importBtn.addEventListener('click',()=>{
      const inp = document.createElement('input'); inp.type='file'; inp.accept='.json,application/json';
      inp.onchange = e=>{
        const f = e.target.files[0]; if(!f) return;
        const r = new FileReader(); r.onload = ev=>{
          try{ const parsed = JSON.parse(ev.target.result); if(Array.isArray(parsed)){ saveRecords(parsed); renderRecords(); alert('İmport uğurla tamamlandı'); } else alert('Fayl formatı uyğun deyil'); }catch(err){alert('Oxuma xətası: ' + err.message)}
        };
        r.readAsText(f);
      };
      inp.click();
    });

    // form events
    [gul,aid,arz].forEach(inp=>inp.addEventListener('input',computeTotal));
    saveBtn.addEventListener('click',saveCurrent);
    clearBtn.addEventListener('click',clearForm);
    clearAllBtn.addEventListener('click',clearAll);

    // new day: clears form and scrolls
    newDayBtn.addEventListener('click',()=>{
      if(!confirm('Yeni günə keçmək istəyirsiniz? Sahələr sıfırlanacaq, cari qeydi saxlamısınızsa "Saxla" düyməsini basın.')) return;
      clearForm();
    });

    // clock & date
    function tickClock(){
      const d = new Date();
      todayDisplay.textContent = 'Tarix: ' + niceDateISO(nowDate());
      clockEl.textContent = d.toLocaleTimeString();
    }
    setInterval(tickClock,1000); tickClock();

    // initial
    computeTotal(); renderRecords();

    // keyboard quick save (Ctrl+S)
    window.addEventListener('keydown',e=>{
      if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='s'){
        e.preventDefault(); saveCurrent();
      }
    });

    // Touch: quick add helper (double-tap save)
    let lastTap=0; document.body.addEventListener('touchend', ()=>{ const t = Date.now(); if(t-lastTap<300) saveCurrent(); lastTap=t; });

  </script>
</body>
</html>
