<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WhatsApp Stilind…ô Online Mesajla≈üma</title>
  <link rel="manifest" href="data:application/manifest+json,{\"name\":\"WhatsApp Stil Chat\",\"short_name\":\"Chat\",\"start_url\":\".\",\"display\":\"standalone\"}">
  <style>
    :root{
      --bg: #0b141a;
      --panel: #111b21;
      --panel-2: #202c33;
      --accent: #00a884; /* WhatsApp green */
      --accent-2: #25d366;
      --text: #e9edef;
      --muted: #8696a0;
      --mine: #005c4b; /* my bubble */
      --other: #202c33; /* other bubble */
      --bubble-shadow: 0 2px 6px rgba(0,0,0,.25);
    }
    *{box-sizing:border-box}
    html,body{height:100%;}
    body{
      margin:0; background:linear-gradient(180deg,#0b141a,#111b21 80%); color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial;
      overflow:hidden;
    }

    /* App Shell */
    .app{display:grid; grid-template-columns: 340px 1fr; height:100vh;}
    @media (max-width: 900px){ .app{ grid-template-columns: 1fr } .sidebar{ display:none } }

    /* Sidebar (Chats) */
    .sidebar{ background:var(--panel); border-right:1px solid #1f2c33; display:flex; flex-direction:column; }
    .sidebar header{
      padding:14px 16px; border-bottom:1px solid #1f2c33; display:flex; align-items:center; gap:10px;
      background:linear-gradient(90deg, var(--panel), #0e1a20);
    }
    .avatar{ width:36px; height:36px; border-radius:50%; background:linear-gradient(135deg,#2a3942,#0e1a20); display:grid; place-items:center; font-weight:700; color:#cfe9e5 }
    .search{ padding:10px 12px }
    .search input{
      width:100%; padding:10px 12px; border-radius:999px; border:1px solid #223038; background:#0e1d24; color:var(--text);
      outline:none;
    }
    .room{ display:flex; align-items:center; gap:12px; padding:12px 14px; cursor:pointer; border-bottom:1px solid #132229; }
    .room:hover{ background:#0f1f26 }
    .room .name{ font-weight:600 }
    .room .last{ font-size:12px; color:var(--muted) }

    /* Chat Area */
    .chat{ display:grid; grid-template-rows: auto 1fr auto; height:100vh; }
    .chat header{
      padding:10px 16px; border-bottom:1px solid #1f2c33; display:flex; align-items:center; gap:12px; background:var(--panel);
      position:relative; overflow:hidden;
    }
    .chat header::after{ /* subtle animated gradient */
      content:""; position:absolute; inset:-40%; background:conic-gradient(from 180deg at 50% 50%, transparent, rgba(37,211,102,.05), transparent 30%);
      animation: spin 12s linear infinite;
    }
    @keyframes spin{ to{ transform: rotate(360deg) } }

    .messages{ background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="144" height="144" viewBox="0 0 144 144"><g fill="%23202c33" opacity="0.25"><circle cx="12" cy="12" r="1"/><circle cx="72" cy="30" r="1"/><circle cx="132" cy="72" r="1"/><circle cx="48" cy="102" r="1"/><circle cx="18" cy="138" r="1"/></g></svg>') repeat; 
      background-color:#0b141a; padding:20px 24px; overflow:auto; display:flex; flex-direction:column;
    }
    .date-divider{ align-self:center; background:#1f2c33; color:#cbd5dc; font-size:12px; padding:6px 10px; border-radius:999px; margin:10px 0; opacity:.9 }

    .bubble{ max-width:min(70%, 560px); padding:8px 10px 6px; border-radius:14px; box-shadow:var(--bubble-shadow); position:relative; margin:4px 0; display:inline-block; animation: pop .18s ease-out;}
    @keyframes pop{ from{ transform: translateY(6px) scale(.98); opacity:.0 } to{ transform: translateY(0) scale(1); opacity:1 } }
    .bubble.mine{ background:var(--mine); align-self:flex-end; border-bottom-right-radius:4px; }
    .bubble.other{ background:var(--other); align-self:flex-start; border-bottom-left-radius:4px; }
    .meta{ display:flex; align-items:center; gap:6px; color:#cfe9e5; opacity:.7; font-size:11px; margin-top:2px }
    .ticks{ display:inline-flex; gap:2px }
    .tick{ width:10px; height:2px; border-radius:2px; background:#cfe9e5; opacity:.7 }
    .tick.double::after{ content:""; display:block; width:10px; height:2px; border-radius:2px; background:#cfe9e5; transform:translateX(3px) translateY(-2px); opacity:.9 }

    .typing{ display:flex; align-items:center; gap:8px; padding:8px 12px; align-self:flex-start; background:#19252b; border-radius:16px; margin:6px 0; }
    .dot{ width:6px; height:6px; border-radius:50%; background:#cfe9e5; opacity:.6; animation: bounce 1.2s infinite; }
    .dot:nth-child(2){ animation-delay:.2s }
    .dot:nth-child(3){ animation-delay:.4s }
    @keyframes bounce{ 0%,80%,100%{ transform:translateY(0); opacity:.5 } 40%{ transform:translateY(-6px); opacity:1 } }

    .composer{ display:flex; gap:8px; align-items:center; padding:10px; background:var(--panel-2); border-top:1px solid #1f2c33 }
    .composer .field{ flex:1; position:relative }
    .composer input[type="text"]{
      width:100%; padding:12px 46px 12px 46px; border-radius:999px; border:1px solid #16323a; background:#0b1f24; color:var(--text); outline:none;
    }
    .composer button, .composer .icon-btn{
      border:0; background:var(--accent); color:#00261d; font-weight:700; padding:12px 14px; border-radius:999px; cursor:pointer; box-shadow:0 6px 18px rgba(0,168,132,.25); transition: transform .08s ease, box-shadow .18s ease;
    }
    .composer button:active, .icon-btn:active{ transform: translateY(2px); box-shadow:0 2px 8px rgba(0,168,132,.25) }
    .icon-btn{ width:40px; height:40px; display:grid; place-items:center; font-size:18px; background:#0e2f2a; color:#9ee5d3; border:1px solid #18493f }
    .emoji-box{ position:absolute; left:10px; top:50%; transform:translateY(-50%); font-size:20px; opacity:.9; cursor:pointer }
    .attach-box{ position:absolute; right:10px; top:50%; transform:translateY(-50%); font-size:18px; opacity:.75; cursor:pointer }

    .login-overlay{ position:fixed; inset:0; display:grid; place-items:center; backdrop-filter: blur(10px); background:linear-gradient(180deg, rgba(11,20,26,.7), rgba(17,27,33,.85)); z-index:30 }
    .login{ background:#0f1f26; border:1px solid #1f2c33; border-radius:20px; padding:24px; width:min(480px, 92%); box-shadow:0 20px 60px rgba(0,0,0,.4) }
    .login h2{ margin:0 0 6px }
    .login p{ margin:4px 0 16px; color:var(--muted) }
    .row{ display:flex; gap:10px }
    .row .col{ flex:1 }
    .login input, .login select{ width:100%; padding:12px; border-radius:12px; border:1px solid #223038; background:#0b1f24; color:var(--text); outline:none }
    .login .go{ width:100%; margin-top:14px; padding:12px; background:var(--accent); color:#00261d; font-weight:800; border:0; border-radius:12px; cursor:pointer }

    /* Toast */
    .toast{ position:fixed; left:50%; bottom:24px; transform:translateX(-50%); background:#13302b; color:#b3f0df; padding:10px 14px; border-radius:12px; border:1px solid #1a4b41; opacity:0; pointer-events:none; transition: opacity .25s ease; z-index:40 }
    .toast.show{ opacity:1 }

  </style>
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <header>
        <div class="avatar" id="meAvatar">ME</div>
        <div>
          <div id="meName" style="font-weight:700">ƒ∞stifad…ô√ßi</div>
          <div style="font-size:12px; color:var(--muted)">Otaq: <span id="roomLabel">default</span></div>
        </div>
      </header>
      <div class="search"><input id="search" placeholder="Axtar... (demo)" /></div>
      <div id="rooms"></div>
    </aside>

    <section class="chat">
      <header>
        <div class="avatar" id="roomAvatar">CH</div>
        <div style="position:relative; z-index:1">
          <div style="font-weight:700" id="roomName">Demo Otaq</div>
          <div style="font-size:12px; color:var(--muted)" id="roomStatus">Onlayn</div>
        </div>
      </header>

      <main class="messages" id="messages"></main>

      <footer class="composer">
        <button class="icon-btn" id="addRoom" title="Yeni otaq">Ôºã</button>
        <div class="field">
          <div class="emoji-box" id="emoji">üòä</div>
          <input id="text" type="text" placeholder="Mesaj yazƒ±n..." autocomplete="off" />
          <div class="attach-box" title="Fayl …ôlav…ô et">üìé</div>
        </div>
        <button id="send">G√∂nd…ôr ‚ñ∏</button>
      </footer>
    </section>
  </div>

  <div class="login-overlay" id="loginOverlay" hidden>
    <div class="login">
      <h2>Adƒ±nƒ±zƒ± se√ßin</h2>
      <p>WhatsApp stilind…ô animasiyalƒ± chat ‚Äì s√ºr…ôtli test √º√ß√ºn ad v…ô otaq yazƒ±n.</p>
      <div class="row">
        <div class="col"><input id="nickInput" placeholder="Ad (m…ôs: Arzu)" maxlength="16"></div>
        <div class="col"><input id="roomInput" placeholder="Otaq (m…ôs: baku)" maxlength="24"></div>
      </div>
      <button class="go" id="startBtn">Daxil ol</button>
      <p style="font-size:12px; color:var(--muted); margin-top:10px">Linki payla≈üaraq eyni otaƒüa qo≈üula bil…ôrsiniz: <code>https://.../#otaq-adƒ±</code></p>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <audio id="sndSend" src="data:audio/mp3;base64,//uQZAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQAA" preload="auto"></audio>
  <audio id="sndRecv" src="data:audio/mp3;base64,//uQZAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQAA" preload="auto"></audio>

  <script>
    /**
     * WhatsApp-stil Chat ‚Äì T…ômiz HTML/CSS/JS
     * \nX√ºsusiyy…ôtl…ôr:
     *  - Animasiya il…ô a√ßƒ±lan/sil…ôn mesajlar, typing indikatoru
     *  - Mobil uyƒüun (responsive)
     *  - Otaq sistemi (URL hash -> #room)
     *  - Yerli demo: BroadcastChannel + localStorage
     *  - Onlayn real-time √º√ß√ºn hazƒ±r adapter: Firebase (ist…ôs…ôniz konfiqurasiya …ôlav…ô edin)
     */

    // ==== Ki√ßik util funksiyalar ====
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    const uid = () => Math.random().toString(36).slice(2,10);
    const now = () => new Date();
    const timeStr = d => d.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});

    function toast(msg){
      const el = $('#toast'); el.textContent = msg; el.classList.add('show');
      setTimeout(()=> el.classList.remove('show'), 1800);
    }

    // ==== Model ====
    let ME = { id: localStorage.getItem('me.id') || uid(), name: localStorage.getItem('me.name') || 'Qonaq' };
    let ROOM = (location.hash.slice(1) || localStorage.getItem('room') || 'default').toLowerCase();

    // Simg…ô ba≈ü h…ôrf
    function initials(name){ return (name||'U').trim().charAt(0).toUpperCase(); }

    // ==== UI Ba≈ülat ====
    function setProfile(){
      $('#meName').textContent = ME.name;
      $('#meAvatar').textContent = initials(ME.name);
      $('#roomLabel').textContent = ROOM;
      $('#roomName').textContent = ROOM;
      $('#roomAvatar').textContent = initials(ROOM);
    }

    // Mesaj elementini yarat
    function msgEl(m){
      const wrap = document.createElement('div');
      const mine = m.userId === ME.id;
      wrap.className = `bubble ${mine? 'mine':'other'}`;
      wrap.dataset.id = m.id;
      wrap.innerHTML = `
        <div class="text">${escapeHtml(m.text).replace(/\\n/g,'<br>')}</div>
        <div class="meta">
          <span class="t">${timeStr(new Date(m.ts))}</span>
          ${mine ? '<span class="ticks"><span class="tick double"></span></span>' : ''}
        </div>`;
      return wrap;
    }

    // Sad…ô t…ôhl√ºk…ôsizl…ô≈üdirm…ô
    function escapeHtml(str){
      return (str||'').replace(/[&<>\\"]/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[s]));
    }

    // Tarix ayƒ±rƒ±cƒ±
    function ensureDateDivider(container, d){
      const key = d.toDateString();
      if(!container.querySelector(`[data-date='${key}']`)){
        const dv = document.createElement('div');
        dv.className='date-divider'; dv.dataset.date=key; dv.textContent = key;
        container.appendChild(dv);
      }
    }

    function scrollBottom(){ const el = $('#messages'); el.scrollTop = el.scrollHeight; }

    // ==== Demo Storage (local) & Broadcast ====
    const CH = new BroadcastChannel('chat-demo');
    CH.onmessage = ev => {
      if(!ev?.data) return;
      const {room, type, payload} = ev.data;
      if(room !== ROOM) return;
      if(type === 'message'){ addMessageToUI(payload, false); playRecv(); }
      if(type === 'typing'){ showTyping(payload); }
    };

    function saveMessageLocal(m){
      const key = `chat:${ROOM}`;
      const arr = JSON.parse(localStorage.getItem(key) || '[]');
      arr.push(m); localStorage.setItem(key, JSON.stringify(arr));
    }

    function loadMessages(){
      const key = `chat:${ROOM}`;
      return JSON.parse(localStorage.getItem(key) || '[]');
    }

    // ==== Firebase (opsional) ====
    // Onlayn real-time √º√ß√ºn bu hiss…ôni aktivl…ô≈üdirin:
    // 1) https://console.firebase.google.com -> Web App yaradƒ±n
    // 2) Konfiqurasiyanƒ± a≈üaƒüƒ±dakƒ± firebaseConfig-…ô doldurun
    // 3) index.html-d…ô <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    //    v…ô <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script> …ôlav…ô edin
    // 4) initFirebase(); √ßaƒüƒ±rƒ±n

    const firebaseEnabled = true; // TRUE ed…ônd…ô real-time olacaq (konfiq lazƒ±mdƒ±r)
    const firebaseConfig = {
      // apiKey: "",
      // authDomain: "",
      // databaseURL: "",
      // projectId: "",
      // storageBucket: "",
      // messagingSenderId: "",
      // appId: ""
    };

    let db = null;
    function initFirebase(){
      if(typeof firebase === 'undefined'){ console.warn('Firebase skriptl…ôri …ôlav…ô olunmayƒ±b.'); return; }
      try{
        firebase.initializeApp(firebaseConfig);
        db = firebase.database();
        const ref = db.ref(`rooms/${ROOM}`);
        ref.limitToLast(50).on('child_added', snap => {
          const m = snap.val(); if(m.userId === ME.id) return; addMessageToUI(m,false); playRecv();
        });
      }catch(e){ console.error(e); }
    }

    function sendFirebase(m){ if(db){ db.ref(`rooms/${ROOM}`).push(m); } }

    // ==== Typing indikatoru ====
    let typingTimer = null; let typingEl = null; let lastTypedAt = 0;
    function showTyping(payload){
      const ms = $('#messages');
      if(!typingEl){
        typingEl = document.createElement('div'); typingEl.className='typing';
        typingEl.innerHTML = '<div class="dot"></div><div class="dot"></div><div class="dot"></div>';
        ms.appendChild(typingEl); scrollBottom();
      }
      clearTimeout(typingTimer);
      typingTimer = setTimeout(()=>{ typingEl?.remove(); typingEl = null; }, 1400);
    }

    // ==== S…ôsl…ôr ====
    function playSend(){ $('#sndSend')?.play?.().catch(()=>{}); }
    function playRecv(){ $('#sndRecv')?.play?.().catch(()=>{}); }

    // ==== UI Eventl…ôri ====
    $('#emoji').addEventListener('click', ()=>{
      $('#text').value += 'üòä';
      $('#text').focus();
    });

    $('#text').addEventListener('input', ()=>{
      // typing siqnalƒ± (yalnƒ±z demo kanalƒ±nda)
      const nowTs = Date.now();
      if(nowTs - lastTypedAt > 400){
        CH.postMessage({ room: ROOM, type: 'typing', payload: { userId: ME.id } });
        lastTypedAt = nowTs;
      }
    });

    $('#send').addEventListener('click', sendMessage);
    $('#text').addEventListener('keydown', e=>{
      if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); sendMessage(); }
    });

    $('#addRoom').addEventListener('click', ()=>{
      const r = prompt('Yeni otaq adƒ±:', 'team');
      if(!r) return; location.hash = r.toLowerCase(); location.reload();
    });

    function sendMessage(){
      const inp = $('#text');
      const txt = inp.value.trim(); if(!txt) return;
      const m = { id: uid(), room: ROOM, userId: ME.id, userName: ME.name, text: txt, ts: Date.now() };
      addMessageToUI(m, true); saveMessageLocal(m); playSend();
      // Demo yayƒ±mƒ± (eyni komp√ºterd…ô dig…ôr p…ônc…ôr…ôy…ô)
      CH.postMessage({ room: ROOM, type: 'message', payload: m });
      // Firebase varsa
      if(firebaseEnabled) sendFirebase(m);
      inp.value=''; inp.focus();
    }

    function addMessageToUI(m, mine){
      const ms = $('#messages');
      const d = new Date(m.ts);
      ensureDateDivider(ms, d);
      const el = msgEl(m);
      ms.appendChild(el);
      scrollBottom();
    }

    // ==== Login axƒ±nƒ± ====
    function ensureLogin(){
      const firstTime = !localStorage.getItem('me.name');
      const overlay = $('#loginOverlay');
      if(firstTime){
        overlay.hidden = false;
        $('#nickInput').value = '';
        $('#roomInput').value = ROOM || '';
      }
      $('#startBtn').onclick = () => {
        const name = ($('#nickInput').value || 'ƒ∞stifad…ô√ßi').trim().slice(0,16);
        const room = ($('#roomInput').value || ROOM || 'default').trim().toLowerCase();
        ME.name = name; localStorage.setItem('me.name', name);
        ME.id = uid(); localStorage.setItem('me.id', ME.id);
        ROOM = room; localStorage.setItem('room', ROOM);
        location.hash = '#'+ROOM;
        overlay.hidden = true; setProfile(); init();
        toast('Xo≈ü g…ôldiniz, ' + name + '!');
      };
    }

    // ==== Ba≈ülat ====
    function init(){
      setProfile();
      $('#messages').innerHTML = '';
      loadMessages().forEach(m => addMessageToUI(m, m.userId===ME.id));
      scrollBottom();
      if(firebaseEnabled) initFirebase();
    }

    // Room-u linkd…ôn qur
    if(location.hash){ ROOM = location.hash.slice(1).toLowerCase(); }

    // ƒ∞lk a√ßƒ±lƒ±≈ü
    setProfile();
    init();
    ensureLogin();

    // Otaq d…ôyi≈ü…ônd…ô
    window.addEventListener('hashchange', ()=>{ location.reload(); });

  </script>
</body>
</html>
